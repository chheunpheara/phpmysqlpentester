<?php

require_once('./autoloader.php');

$page = ! empty($_GET['page']) ? $_GET['page'] : 'home';
$route = ! empty($_GET['route']) ? $_GET['route'] : '';
$page = ucfirst($page);
$pageController = new \controller\PageController;
$page = $pageController->setPage($page);
$controller = "\controller\\$page" . "Controller";
$controller = new $controller;

$methods = get_class_methods($controller);
if (in_array($route, $methods)) {
    $id = ! empty($_GET['id']) ? $_GET['id'] : 0;
    $file = ! empty($_GET['file']) ? $_GET['file'] : '';
    if ($id > 0) {
        call_user_func_array([$controller, $route], [$id]);
    }

    if (! empty($file)) {
        call_user_func_array([$controller, $route], [$file]);
    }
} else {
    // Default homepage (HomeController, index)
    call_user_func([$controller, 'index']);
}
